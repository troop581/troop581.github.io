"use strict";var app=angular.module("app",["ngRoute","ngSanitize","ui.bootstrap"]);app.config(["$tooltipProvider","$routeProvider","$httpProvider","$locationProvider",function(n,t,i){n.options({popupDelay:500});i.defaults.withCredentials=!0;t.when("/flags",{title:"Flags",templateUrl:"app/modules/flags.html",resolve:{dataService:function(n){return n.init()}}}).when("/flyer",{title:"Flyer",templateUrl:"app/modules/flyer.html",resolve:{dataService:function(n){return n.init()}}}).when("/success",{title:"Thank you",templateUrl:"app/modules/success.html",resolve:{dataService:function(n){return n.init()}}}).when("/calendar",{title:"Calendar",templateUrl:"app/modules/calendar.html",resolve:{dataService:function(n){return n.init()}}}).when("/requirements",{title:"Requirements",templateUrl:"app/modules/requirements.html",resolve:{dataService:function(n){return n.init()}}}).otherwise({redirectTo:"/flags"})}]);app.run(["$route","$rootScope",function(n,t){t.$on("$routeChangeSuccess",function(n,i){t.title="Troop 581 - "+i.$$route.title})}]);toastr.options={closeButton:!1,debug:!1,positionClass:"toast-bottom-left",onclick:null,showDuration:"4000",hideDuration:"1000",timeOut:"4000",extendedTimeOut:"1000",showEasing:"linear",hideEasing:"linear",showMethod:"show",hideMethod:"hide"};app.controller("header",["$location","dataService",function(n,t){var i=this;return i.data=t,i.location=n,i}]);app.controller("shell",["$location","$modal","dataService",function(n,t,i){var r=this;return r.data=i,r.isActive=function(t){return t===n.path().substr(0,t.length)},r.openSettings=function(){var n=t.open({templateUrl:"app/modules/settings.html",controller:"settings as vm"});n.result.then(function(){},function(){})},r}]);app.controller("calendar",["dataService","$q",function(n){var t=this;return t.data=n,function(){}(),t}]);app.controller("flags.boundaries",["dataService","$modalInstance","$q",function(n,t){var i=this;return i.data=n,i.close=function(){t.close()},function(){}(),i}]);app.controller("flags",["dataService","$q","$modal","$timeout","$filter",function(n,t,i,r,u){var f=this;return f.data=n,f.autosave=function(){localStorage.setItem("flags.values",JSON.stringify(n.values))},f.donate=function(t){if(toastr.clear(),!n.values.subscribe&&!n.values.donate){toastr.warning("","You have not selected the flag service or a donation.");t.preventDefault();return}if(!!n.values.donate&&!n.values.donation){toastr.warning("","You selected to give a donation but did not enter an amount.");t.preventDefault();return}if(!!n.values.donation&&(!_.isFinite(n.values.donation)||parseFloat(n.values.donation)<0)){toastr.warning("","Please check your donation amount. It doesn't appear to be correct.");t.preventDefault();return}if(n.values.subscribe&&f.getTotal()<40){toastr.error("","An error occurred. Please fix the data and try again.",{timeOut:0});t.preventDefault();return}if(f.getTotal()<5){toastr.warning("","$5.00 is the minimum amount we can process through PayPal.");t.preventDefault();return}if(!n.values.name||!(n.values.address||!n.values.subscribe)){toastr.warning("","Please fill in all required fields.");t.preventDefault();return}toastr.info("","You will now be sent to PayPal to finish the transaction.",{timeOut:0});r(function(){},5e3)},f.getAmount=function(){var t=0;return n.values.subscribe?(t+=40,n.values.donate&&n.values.donation&&(t+=parseFloat(n.values.donation))):n.values.donate&&n.values.donation&&(t+=parseFloat(n.values.donation)),t},f.getDescription=function(){var t="";return n.values.subscribe?(t+="2015 Flag Subscription",n.values.donate&&n.values.donation&&(t+=" and Donation of "+u("currency")(n.values.donation,"$",2))):n.values.donate&&n.values.donation&&(t+="Donation of "+u("currency")(n.values.donation,"$",2)),t},f.getDonation=function(){return _.isFinite(n.values.donation)?parseFloat(n.values.donation)<0?0:parseFloat(n.values.donation):0},f.getTotal=function(){var t=0;return n.values.subscribe&&(t=t+40),n.values.donate&&(t=t+f.getDonation()),t},f.showBoundaries=function(){toastr.clear();var n=i.open({templateUrl:"app/modules/flags.boundaries.html",controller:"flags.boundaries as vm",size:"lg"});n.result.then(function(){},function(){})},function(){n.values=JSON.parse(localStorage.getItem("flags.values"))||{}}(),f}]);app.controller("flyer",["dataService","$q","$modal","$timeout","$filter",function(n){var t=this;return t.data=n,function(){}(),t}]);app.controller("requirements",["dataService","$q","$modal",function(n,t,i){function u(){return n.processingRequirements=!0,n.getWebpage(r.meritBadgeUrl,"ol","json").then(function(i){var r;return i=_.castArray(i),_.forEach(i,function(n){if(n.li&&n.li.length>100)return r=n.li,!1}),_.forEach(r,function(t){_.has(t,"a.content")?n.meritBadges[t.a.content]={name:t.a.content,url:"meritbadge.org"+_.get(t,"a.href"),encodedName:_.replace(_.get(t,"a.href"),"/wiki/index.php/",""),type:"Merit Badge"}:_.has(t,"i.b.a.content")&&(n.meritBadges[t.i.b.a.content]={name:t.i.b.a.content,url:"meritbadge.org"+_.get(t,"i.b.a.href"),encodedName:_.replace(_.get(t,"i.b.a.href"),"/wiki/index.php/",""),type:"Merit Badge",required:!0})}),t.all(_.map(n.meritBadges,function(i){return t.all({requirements:n.getWebpage(i.url,"table","xml").then(function(t){var r=$(t).find("table").has(".mw-headline");n.meritBadges[i.name].requirements=$(t).find("table").has(".mw-headline")}),image:n.getWebpage(i.url,"img","json").then(function(t){var r;t=_.castArray(t);_.forEach(t,function(n){if(n.src&&_.includes(n.src,i.encodedName))return r=n,!1});r&&(n.meritBadges[i.name].imgUrl="//meritbadge.org"+r.src)})}).then(function(){n.meritBadges[i.name].ready=!0})})).then(function(){n.requirementsRetrieved=!0})}).finally(function(){n.processingRequirements=!1})}var r=this;return r.data=n,r.meritBadgeUrl="meritbadge.org/wiki/index.php/Merit_Badges",r.showRequirements=function(n){var t=i.open({templateUrl:"app/modules/requirements.show.html",controller:"requirements.show as vm",size:"lg",resolve:{badge:function(){return n}}});t.result.then(function(){},function(){})},function(){n.requirementsRetrieved||n.processingRequirements||u()}(),r}]);app.controller("requirements.show",["dataService","$modalInstance","$q","badge",function(n,t,i,r){var u=this;return u.data=n,u.title="",u.badge=r,u.close=function(){t.close()},t.rendered.then(function(){$("#requirements").html(r.requirements[0].outerHTML);$("#requirements table:first tr:first").remove();$("#requirements table:last").remove();$("#requirements table div:last").remove();$("#requirements table").removeAttr("style")}),function(){}(),u}]);app.controller("success",["dataService","$q","$modal","$timeout","$filter",function(n){var t=this;return t.data=n,function(){}(),t}]);app.factory("dataService",["$http","$filter","$q",function(n){function r(n,t,i,r){var u=moment().year(r).month(i).date(1).hours(0).minutes(0).seconds(0).milliseconds(0);if(n===-1)for(u.endOf("month").startOf("day");u.day()!==t;)u.subtract(1,"day");else for(u.date((n-1)*7+1);u.day()!==t;)u.add(1,"day");return u}var t={};t.year=2016;t.meritBadges={};t.values={};var i=1,u=3;return t.holidays=[{text:"Memorial Day",date:r(-1,i,4,t.year),dateNoYear:"Last Monday in May"},{text:"Flag Day",date:moment(t.year+"-06-14"),dateNoYear:"June 14th"},{text:"Independence Day",date:moment(t.year+"-07-04"),dateNoYear:"July 4th"},{text:"Patriot Day",date:moment(t.year+"-09-11"),dateNoYear:"September 11th"},{text:"Columbus Day",date:r(2,i,9,t.year),dateNoYear:"Second Monday in October"},{text:"Veterans Day",date:moment(t.year+"-11-11"),dateNoYear:"November 11th"},{text:"Martin Luther King, Jr. Day",date:r(u,i,0,t.year+1),dateNoYear:"Third Monday in January"},{text:"Presidents' Day",date:r(u,i,1,t.year+1),dateNoYear:"Third Monday in February"}],t.getWebpage=function(t,i,r){return n.get("https://query.yahooapis.com/v1/public/yql?q=SELECT%20*%20FROM%20data.html.cssselect%20WHERE%20url%3D'"+encodeURI(t)+"'%20AND%20css%3D'"+i+"'&format="+r+"&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys",{withCredentials:!1}).then(function(n){return r==="json"?n.data.query.results.results[i]:$.parseXML(n.data)})},t.processDonation=function(t){return n.get(t).then(function(n){return n})},t.init=function(){},t}]);app.directive("dropTarget",function(){return{restrict:"A",scope:{drop:"&"},link:function(n,t){var i=0;t.bind("dragover",function(n){n.preventDefault&&n.preventDefault();n.stopPropogation&&n.stopPropogation();n.originalEvent.dataTransfer.dropEffect="copy"});t.bind("dragenter",function(n){i++;n.preventDefault&&n.preventDefault();n.stopPropogation&&n.stopPropogation();n.originalEvent.dataTransfer.dropEffect="copy";angular.element(n.currentTarget).addClass("alert-success");angular.element(n.currentTarget).removeClass("alert-info")});t.bind("dragleave",function(n){i--;i===0&&(angular.element(n.currentTarget).addClass("alert-info"),angular.element(n.currentTarget).removeClass("alert-success"));n.preventDefault&&n.preventDefault();n.stopPropogation&&n.stopPropogation();n.originalEvent.dataTransfer.dropEffect="copy"});t.bind("drop",function(t){t.preventDefault&&t.preventDefault();t.stopPropogation&&t.stopPropogation();angular.element(t.currentTarget).addClass("alert-info");angular.element(t.currentTarget).removeClass("alert-success");var i=t.originalEvent.dataTransfer.files;n.$apply(function(){n.drop({files:i})})})}}});app.directive("floatThead",function(){return{restrict:"A",link:function(n,t){$(t).floatThead()}}});app.filter("momentToString",["$filter","$locale",function(){return function(n,t){return moment.isMoment(n)?n.format(t):""}}]);app.filter("objToArray",["$filter",function(){return function(n){return(n instanceof Object)?_.values(n):n}}]);app.filter("porgSite",["$filter",function(){return function(n,t){var i=[];return _.forEach(n,function(n){(t==="all"||n.parentPOrg===t)&&i.push(n)}),i}}]);