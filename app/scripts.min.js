"use strict";var app=angular.module("app",["ngRoute","ngSanitize","ui.bootstrap"]);app.config(["$tooltipProvider","$routeProvider","$httpProvider","$locationProvider",function(n,t,i){n.options({popupDelay:500});i.defaults.withCredentials=!0;t.when("/flags",{templateUrl:"app/modules/flags.html",resolve:{dataService:function(n){return n.init()}}}).when("/flyer",{templateUrl:"app/modules/flyer.html",resolve:{dataService:function(n){return n.init()}}}).when("/success",{templateUrl:"app/modules/success.html",resolve:{dataService:function(n){return n.init()}}}).when("/calendar",{templateUrl:"app/modules/calendar.html",resolve:{dataService:function(n){return n.init()}}}).when("/requirements",{templateUrl:"app/modules/requirements.html",resolve:{dataService:function(n){return n.init()}}}).otherwise({redirectTo:"/flags"})}]);app.run(["$route",function(){}]);toastr.options={closeButton:!1,debug:!1,positionClass:"toast-bottom-left",onclick:null,showDuration:"4000",hideDuration:"1000",timeOut:"4000",extendedTimeOut:"1000",showEasing:"linear",hideEasing:"linear",showMethod:"show",hideMethod:"hide"};app.controller("header",["$location","dataService",function(n,t){var i=this;return i.data=t,i.location=n,i}]);app.controller("shell",["$location","$modal","dataService",function(n,t,i){var r=this;return r.data=i,r.isActive=function(t){return t===n.path().substr(0,t.length)},r.openSettings=function(){var n=t.open({templateUrl:"app/modules/settings.html",controller:"settings as vm"});n.result.then(function(){},function(){})},r}]);app.controller("calendar",["dataService","$q",function(n){var t=this;return t.data=n,function(){}(),t}]);app.controller("flags.boundaries",["dataService","$modalInstance","$q",function(n,t){var i=this;return i.data=n,i.close=function(){t.close()},function(){}(),i}]);app.controller("flags",["dataService","$q","$modal","$timeout","$filter",function(n,t,i,r,u){function s(n,t,i,r){var u=moment().year(r).month(i).date(1).hours(0).minutes(0).seconds(0).milliseconds(0);if(n===-1)for(u.endOf("month").startOf("day");u.day()!==t;)u.subtract(1,"day");else for(u.date((n-1)*7+1);u.day()!==t;)u.add(1,"day");return u}var f=this;f.data=n;var e=2015,o=1,h=2;return f.holidays=[{text:"Memorial Day",date:s(-1,o,4,e)},{text:"Flag Day",date:moment(e+"-06-14")},{text:"Independence Day",date:moment(e+"-07-04")},{text:"Patriot Day",date:moment(e+"-09-11")},{text:"Columbus Day",date:s(h,o,9,e)},{text:"Veterans Day",date:moment(e+"-11-11")},{text:"Martin Luther King, Jr. Day",date:s(h,o,0,e+1)},{text:"Presidents' Day",date:s(3,o,1,e+1)}],f.autosave=function(){localStorage.setItem("flags.values",JSON.stringify(n.values))},f.donate=function(t){if(toastr.clear(),!n.values.subscribe&&!n.values.donate){toastr.warning("","You have not selected the flag service or a donation.");t.preventDefault();return}if(!!n.values.donate&&!n.values.donation){toastr.warning("","You selected to give a donation but did not enter an amount.");t.preventDefault();return}if(!!n.values.donation&&(!_.isFinite(n.values.donation)||parseFloat(n.values.donation)<0)){toastr.warning("","Please check your donation amount. It doesn't appear to be correct.");t.preventDefault();return}if(n.values.subscribe&&f.getTotal()<40){toastr.error("","An error occurred. Please fix the data and try again.",{timeOut:0});t.preventDefault();return}if(f.getTotal()<5){toastr.warning("","$5.00 is the minimum amount we can process through PayPal.");t.preventDefault();return}if(!n.values.name||!(n.values.address||!n.values.subscribe)){toastr.warning("","Please fill in all required fields.");t.preventDefault();return}toastr.info("","You will now be sent to PayPal to finish the transaction.",{timeOut:0});r(function(){},5e3)},f.getAmount=function(){var t=0;return n.values.subscribe?(t+=40,n.values.donate&&n.values.donation&&(t+=parseFloat(n.values.donation))):n.values.donate&&n.values.donation&&(t+=parseFloat(n.values.donation)),t},f.getDescription=function(){var t="";return n.values.subscribe?(t+="2015 Flag Subscription",n.values.donate&&n.values.donation&&(t+=" and Donation of "+u("currency")(n.values.donation,"$",2))):n.values.donate&&n.values.donation&&(t+="Donation of "+u("currency")(n.values.donation,"$",2)),t},f.getDonation=function(){return _.isFinite(n.values.donation)?parseFloat(n.values.donation)<0?0:parseFloat(n.values.donation):0},f.getTotal=function(){var t=0;return n.values.subscribe&&(t=t+40),n.values.donate&&(t=t+f.getDonation()),t},f.showBoundaries=function(){toastr.clear();var n=i.open({templateUrl:"app/modules/flags.boundaries.html",controller:"flags.boundaries as vm",size:"lg"});n.result.then(function(){},function(){})},function(){n.values=JSON.parse(localStorage.getItem("flags.values"))||{}}(),f}]);app.controller("flyer",["dataService","$q","$modal","$timeout","$filter",function(n,t,i,r,u){function s(n,t,i,r){var u=moment().year(r).month(i).date(1).hours(0).minutes(0).seconds(0).milliseconds(0);if(n===-1)for(u.endOf("month").startOf("day");u.day()!==t;)u.subtract(1,"day");else for(u.date((n-1)*7+1);u.day()!==t;)u.add(1,"day");return u}var f=this;f.data=n;var e=2015,o=1,h=2;return f.holidays=[{text:"Memorial Day",date:s(-1,o,4,e)},{text:"Flag Day",date:moment(e+"-06-14")},{text:"Independence Day",date:moment(e+"-07-04")},{text:"Patriot Day",date:moment(e+"-09-11")},{text:"Columbus Day",date:s(h,o,9,e)},{text:"Veterans Day",date:moment(e+"-11-11")},{text:"Martin Luther King, Jr. Day",date:s(h,o,0,e+1)},{text:"Presidents' Day",date:s(3,o,1,e+1)}],f.autosave=function(){localStorage.setItem("flags.values",JSON.stringify(n.values))},f.donate=function(t){if(toastr.clear(),!n.values.subscribe&&!n.values.donate){toastr.warning("","You have not selected the flag service or a donation.");t.preventDefault();return}if(!!n.values.donate&&!n.values.donation){toastr.warning("","You selected to give a donation but did not enter an amount.");t.preventDefault();return}if(!!n.values.donation&&(!_.isFinite(n.values.donation)||parseFloat(n.values.donation)<0)){toastr.warning("","Please check your donation amount. It doesn't appear to be correct.");t.preventDefault();return}if(n.values.subscribe&&f.getTotal()<40){toastr.error("","An error occurred. Please fix the data and try again.",{timeOut:0});t.preventDefault();return}if(f.getTotal()<5){toastr.warning("","$5.00 is the minimum amount we can process through PayPal.");t.preventDefault();return}if(!n.values.name||!(n.values.address||!n.values.subscribe)){toastr.warning("","Please fill in all required fields.");t.preventDefault();return}toastr.info("","You will now be sent to PayPal to finish the transaction.",{timeOut:0});r(function(){},5e3)},f.getAmount=function(){var t=0;return n.values.subscribe?(t+=40,n.values.donate&&n.values.donation&&(t+=parseFloat(n.values.donation))):n.values.donate&&n.values.donation&&(t+=parseFloat(n.values.donation)),t},f.getDescription=function(){var t="";return n.values.subscribe?(t+="2015 Flag Subscription",n.values.donate&&n.values.donation&&(t+=" and Donation of "+u("currency")(n.values.donation,"$",2))):n.values.donate&&n.values.donation&&(t+="Donation of "+u("currency")(n.values.donation,"$",2)),t},f.getDonation=function(){return _.isFinite(n.values.donation)?parseFloat(n.values.donation)<0?0:parseFloat(n.values.donation):0},f.getTotal=function(){var t=0;return n.values.subscribe&&(t=t+40),n.values.donate&&(t=t+f.getDonation()),t},f.showBoundaries=function(){toastr.clear();var n=i.open({templateUrl:"app/modules/flags.boundaries.html",controller:"flags.boundaries as vm",size:"lg"});n.result.then(function(){},function(){})},function(){n.values=JSON.parse(localStorage.getItem("flags.values"))||{}}(),f}]);app.controller("requirements",["dataService","$q",function(n){function i(){return n.getWebpage("meritbadge.org/wiki/index.php/Merit_Badges").then(function(){console.log("got merit badges...hopefully")})}var t=this;return t.data=n,t.meritBadgeList=[],function(){i()}(),t}]);app.controller("success",["dataService","$q","$modal","$timeout","$filter",function(n){var t=this;return t.data=n,function(){}(),t}]);app.factory("dataService",["$http","$filter","$q",function(n){var t={};return t.values={},t.active=!0,t.getWebpage=function(t){return n.get(t).then(function(n){return n})},t.processDonation=function(t){return n.get(t).then(function(n){return n})},t.init=function(){t.initialized},t}]);app.directive("dropTarget",function(){return{restrict:"A",scope:{drop:"&"},link:function(n,t){var i=0;t.bind("dragover",function(n){n.preventDefault&&n.preventDefault();n.stopPropogation&&n.stopPropogation();n.originalEvent.dataTransfer.dropEffect="copy"});t.bind("dragenter",function(n){i++;n.preventDefault&&n.preventDefault();n.stopPropogation&&n.stopPropogation();n.originalEvent.dataTransfer.dropEffect="copy";angular.element(n.currentTarget).addClass("alert-success");angular.element(n.currentTarget).removeClass("alert-info")});t.bind("dragleave",function(n){i--;i===0&&(angular.element(n.currentTarget).addClass("alert-info"),angular.element(n.currentTarget).removeClass("alert-success"));n.preventDefault&&n.preventDefault();n.stopPropogation&&n.stopPropogation();n.originalEvent.dataTransfer.dropEffect="copy"});t.bind("drop",function(t){t.preventDefault&&t.preventDefault();t.stopPropogation&&t.stopPropogation();angular.element(t.currentTarget).addClass("alert-info");angular.element(t.currentTarget).removeClass("alert-success");var i=t.originalEvent.dataTransfer.files;n.$apply(function(){n.drop({files:i})})})}}});app.directive("floatThead",function(){return{restrict:"A",link:function(n,t){$(t).floatThead()}}});app.filter("momentToString",["$filter","$locale",function(){return function(n,t){return moment.isMoment(n)?n.format(t):""}}]);app.filter("porgSite",["$filter",function(){return function(n,t){var i=[];return _.forEach(n,function(n){(t==="all"||n.parentPOrg===t)&&i.push(n)}),i}}]);