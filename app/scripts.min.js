"use strict";var app=angular.module("app",["ngRoute","ngSanitize","ui.bootstrap"]);app.config(["$tooltipProvider","$routeProvider","$httpProvider","$locationProvider",function(e,t,a,r){e.options({popupDelay:500}),a.defaults.withCredentials=!0,t.when("/flags",{title:"Flags",templateUrl:"app/modules/flags.html",resolve:{dataService:function(e){return e.init()}}}).when("/flyer",{title:"Flyer",templateUrl:"app/modules/flyer.html",resolve:{dataService:function(e){return e.init()}}}).when("/success",{title:"Thank you",templateUrl:"app/modules/success.html",resolve:{dataService:function(e){return e.init()}}}).when("/requirements",{title:"Requirements",templateUrl:"app/modules/requirements.html",resolve:{dataService:function(e){return e.init()}}}).otherwise({redirectTo:"/flags"})}]),app.run(["$route","$rootScope",function(e,t){t.$on("$routeChangeSuccess",function(e,a,r){t.title="Troop 581 - "+a.$$route.title})}]),toastr.options={closeButton:!1,debug:!1,positionClass:"toast-bottom-left",onclick:null,showDuration:"4000",hideDuration:"1000",timeOut:"4000",extendedTimeOut:"1000",showEasing:"linear",hideEasing:"linear",showMethod:"show",hideMethod:"hide"},app.controller("header",["$location","dataService",function(e,t){var a=this;return a.data=t,a.location=e,a}]),app.controller("shell",["$location","$modal","dataService",function(e,t,a){var r=this;return r.data=a,r.isActive=function(t){return t===e.path().substr(0,t.length)},r.openSettings=function(){t.open({templateUrl:"app/modules/settings.html",controller:"settings as vm"}).result.then(function(){},function(){})},r}]),app.controller("flags.boundaries",["dataService","$modalInstance","$q",function(e,t,a){var r=this;return r.data=e,r.close=function(){t.close()},r}]),app.controller("flags",["dataService","$q","$modal","$timeout","$filter",function(e,t,a,r,n){var o=this;return o.data=e,o.autosave=function(){localStorage.setItem("flags.values",JSON.stringify(e.values))},o.donate=function(t){return toastr.clear(),e.values.subscribe||e.values.donate?e.values.donate&&!e.values.donation?(toastr.warning("","You selected to give a donation but did not enter an amount."),void t.preventDefault()):e.values.donation&&(!_.toNumber(e.values.donation)||parseInt(e.values.donation,10)<0)?(toastr.warning("","Please check your donation amount. It doesn't appear to be correct."),void t.preventDefault()):e.values.subscribe&&o.getTotal()<e.cost?(toastr.error("","An error occurred. Please fix the data and try again.",{timeOut:0}),void t.preventDefault()):o.getTotal()<5?(toastr.warning("","$5.00 is the minimum amount we can process through PayPal."),void t.preventDefault()):!e.values.name||!e.values.address&&e.values.subscribe?(toastr.warning("","Please fill in all required fields."),void t.preventDefault()):(toastr.info("","You will now be sent to PayPal to finish the transaction.",{timeOut:0}),void r(function(){},5e3)):(toastr.warning("","You have not selected the flag service or a donation."),void t.preventDefault())},o.getDescription=function(){var t="";return e.values.subscribe?(t+=e.year+" Flag Subscription",e.values.donate&&e.values.donation&&(t+=" and Donation of "+n("currency")(e.values.donation,"$",2))):e.values.donate&&e.values.donation&&(t+="Donation of "+n("currency")(e.values.donation,"$",2)),t},o.getDonation=function(){return _.toNumber(e.values.donation)?parseInt(e.values.donation,10)<0?0:parseInt(e.values.donation,10):0},o.getTotal=function(){var t=0;return e.values.subscribe&&(t+=e.cost),e.values.donate&&(t+=o.getDonation()),t},o.showBoundaries=function(){toastr.clear(),a.open({templateUrl:"app/modules/flags.boundaries.html",controller:"flags.boundaries as vm",size:"lg"}).result.then(function(){},function(){})},function(){e.values=JSON.parse(localStorage.getItem("flags.values"))||{}}(),o}]),app.controller("flyer",["dataService","$q","$modal","$timeout","$filter",function(e,t,a,r,n){var o=this;return o.data=e,o}]),app.controller("requirements",["dataService","$q","$modal",function(e,t,a){function r(){return e.meritBadgesTemp={},e.getWebpage(o.meritBadgeUrl,"ol","json").then(function(a){var r;return a=_.castArray(a),_.forEach(a,function(e){if(e.li&&e.li.length>100)return r=e.li,!1}),_.forEach(r,function(t){_.has(t,"a.content")?e.meritBadgesTemp[t.a.content]={name:t.a.content,url:"meritbadge.org"+_.get(t,"a.href"),encodedName:_.replace(_.get(t,"a.href"),"/wiki/index.php/",""),type:"Merit Badge"}:_.has(t,"i.b.a.content")&&(e.meritBadgesTemp[t.i.b.a.content]={name:t.i.b.a.content,url:"meritbadge.org"+_.get(t,"i.b.a.href"),encodedName:_.replace(_.get(t,"i.b.a.href"),"/wiki/index.php/",""),type:"Merit Badge",required:!0})}),t.all(_.map(e.meritBadgesTemp,function(a){return t.all({requirements:e.getWebpage(a.url,"table","xml").then(function(t){var r=$(t).find("table").has(".mw-headline"),n=$(r).find("tr:first")[0]&&$(r).find("tr:first")[0].outerHTML||"",o=$(r).find("table:last")[0]&&$(r).find("table:last")[0].outerHTML||"",i=$(r).find("div:last")[0]&&$(r).find("div:last")[0].outerHTML||"",s=$(t).find("table").has(".mw-headline")[0].outerHTML;s=_.replace(s,n,""),s=_.replace(s,o,""),s=_.replace(s,i,""),e.meritBadgesTemp[a.name].requirements=s}),image:e.getWebpage(a.url,"img","json").then(function(t){var r;t=_.castArray(t),_.forEach(t,function(e){if(e.src&&_.includes(e.src,a.encodedName))return r=e,!1}),r&&(e.meritBadgesTemp[a.name].imgUrl="//meritbadge.org"+r.src)})}).then(function(t){e.meritBadgesTemp[a.name].ready=!0,e.meritBadges[a.name]=e.meritBadgesTemp[a.name]},function(t){console.log(a.name+" failed: "+t),e.failures.meritBadges.push(a)})})).finally(function(t){localStorage.setItem("meritBadges",JSON.stringify(e.meritBadges))})})}function n(){return e.ranksTemp={Scout:{order:1,name:"Scout",url:"meritbadge.org/wiki/index.php/Scout_Badge",encodedName:"BoyScout",type:"Rank"},Tenderfoot:{order:2,name:"Tenderfoot",url:"meritbadge.org/wiki/index.php/Tenderfoot_rank",encodedName:"Tenderfoot",type:"Rank"},"Second Class":{order:3,name:"Second Class",url:"meritbadge.org/wiki/index.php/Second_Class_rank",encodedName:"SecondClass",type:"Rank"},"First Class":{order:4,name:"First Class",url:"meritbadge.org/wiki/index.php/First_Class_rank",encodedName:"FirstClass",type:"Rank"},Star:{order:5,name:"Star",url:"meritbadge.org/wiki/index.php/Star_rank",encodedName:"Star",type:"Rank"},Life:{order:6,name:"Life",url:"meritbadge.org/wiki/index.php/Life_rank",encodedName:"Life",type:"Rank"},Eagle:{order:7,name:"Eagle",url:"meritbadge.org/wiki/index.php/Eagle_Scout_rank",encodedName:"EagleScout",type:"Rank"},"Eagle Palms":{order:8,name:"Eagle Palms",url:"meritbadge.org/wiki/index.php/Eagle_Palms",encodedName:"Eagle_Palms",type:"Palm"}},t.all(_.map(e.ranksTemp,function(a){return t.all({requirements:e.getWebpage(a.url,"table","xml").then(function(t){var r=$(t).find("table").has(".mw-headline"),n=$(r).find("tr:first")[0]&&$(r).find("tr:first")[0].outerHTML||"",o=$(r).find("table:last")[0]&&$(r).find("table:last")[0].outerHTML||"",i=$(r).find("div:last")[0]&&$(r).find("div:last")[0].outerHTML||"",s=$(t).find("table").has(".mw-headline")[0].outerHTML;s=_.replace(s,n,""),s=_.replace(s,o,""),s=_.replace(s,i,""),e.ranksTemp[a.name].requirements=s}),image:e.getWebpage(a.url,"img","json").then(function(t){var r;t=_.castArray(t),_.forEach(t,function(e){if(e.src&&_.includes(e.src,a.encodedName))return r=e,!1}),r&&(e.ranksTemp[a.name].imgUrl="//meritbadge.org"+r.src)})}).then(function(t){e.ranksTemp[a.name].ready=!0,e.ranks[a.name]=e.ranksTemp[a.name]},function(t){console.log(a.name+" failed: "+t),e.failures.ranks.push(a)})})).finally(function(t){localStorage.setItem("ranks",JSON.stringify(e.ranks))})}var o=this;return o.data=e,o.meritBadgeUrl="meritbadge.org/wiki/index.php/Merit_Badges",o.rankUrl="meritbadge.org/wiki/index.php/Main_Page",o.refresh=function(){return e.processingRequirements=!0,e.failures={ranks:[],meritBadges:[]},t.all({ranks:n(),meritBadges:r()}).finally(function(t){e.processingRequirements=!1})},o.showRequirements=function(e){a.open({templateUrl:"app/modules/requirements.show.html",controller:"requirements.show as vm",size:"lg",resolve:{badge:function(){return e}}}).result.then(function(){},function(){})},function(){!e.processingRequirements&&_.isEmpty(e.meritBadges)&&_.isEmpty(e.ranks)&&o.refresh()}(),o}]),app.controller("requirements.show",["dataService","$modalInstance","$q","badge",function(e,t,a,r){var n=this;return n.data=e,n.title="",n.badge=r,n.close=function(){t.close()},t.rendered.then(function(){$("#requirements").html(r.requirements),$("#requirements table").removeAttr("style"),$("#requirements a").replaceWith(function(){return $(this)[0].innerText})}),n}]),app.controller("success",["dataService","$q","$modal","$timeout","$filter",function(e,t,a,r,n){var o=this;return o.data=e,o}]),app.factory("dataService",["$http","$filter","$q",function(e,t,a){function r(e,t,a,r){var n=moment().year(r).month(a).date(1).hours(0).minutes(0).seconds(0).milliseconds(0);if(-1===e)for(n.endOf("month").startOf("day");n.day()!==t;)n.subtract(1,"day");else for(n.date(7*(e-1)+1);n.day()!==t;)n.add(1,"day");return n}var n={};n.year=2018,n.cost=45,n.meritBadges={},n.values={};return n.holidays=[{text:"Memorial Day",date:r(-1,1,4,n.year),dateNoYear:"Last Monday in May"},{text:"Flag Day",date:moment(n.year+"-06-14"),dateNoYear:"June 14th"},{text:"Independence Day",date:moment(n.year+"-07-04"),dateNoYear:"July 4th"},{text:"Patriot Day",date:moment(n.year+"-09-11"),dateNoYear:"September 11th"},{text:"Columbus Day",date:r(2,1,9,n.year),dateNoYear:"Second Monday in October"},{text:"Veterans Day",date:moment(n.year+"-11-11"),dateNoYear:"November 11th"},{text:"Martin Luther King, Jr. Day",date:r(3,1,0,n.year+1),dateNoYear:"Third Monday in January"},{text:"Presidents' Day",date:r(3,1,1,n.year+1),dateNoYear:"Third Monday in February"}],n.getWebpage=function(t,a,r){return e.get("https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20html%20where%20url%3D'"+encodeURI(t)+"'%20and%20xpath%3D'%2F%2F"+a+"'&format="+r+"&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys",{withCredentials:!1}).then(function(e){return"json"===r?e.data.query.results[a]:$.parseXML(e.data)})},n.processDonation=function(t){return e.get(t).then(function(e){return e})},n.init=function(){n.ranks=JSON.parse(localStorage.getItem("ranks"))||{},n.meritBadges=JSON.parse(localStorage.getItem("meritBadges"))||{}},n}]),app.directive("dropTarget",function(e){return{restrict:"A",scope:{drop:"&"},link:function(e,t,a,r){var n=0;t.bind("dragover",function(e){e.preventDefault&&e.preventDefault(),e.stopPropogation&&e.stopPropogation(),e.originalEvent.dataTransfer.dropEffect="copy"}),t.bind("dragenter",function(e){n++,e.preventDefault&&e.preventDefault(),e.stopPropogation&&e.stopPropogation(),e.originalEvent.dataTransfer.dropEffect="copy",angular.element(e.currentTarget).addClass("alert-success"),angular.element(e.currentTarget).removeClass("alert-info")}),t.bind("dragleave",function(e){n--,0===n&&(angular.element(e.currentTarget).addClass("alert-info"),angular.element(e.currentTarget).removeClass("alert-success")),e.preventDefault&&e.preventDefault(),e.stopPropogation&&e.stopPropogation(),e.originalEvent.dataTransfer.dropEffect="copy"}),t.bind("drop",function(t){t.preventDefault&&t.preventDefault(),t.stopPropogation&&t.stopPropogation(),angular.element(t.currentTarget).addClass("alert-info"),angular.element(t.currentTarget).removeClass("alert-success");var a=t.originalEvent.dataTransfer.files;e.$apply(function(){e.drop({files:a})})})}}}),app.directive("floatThead",function(){return{restrict:"A",link:function(e,t,a){$(t).floatThead()}}}),app.filter("momentToString",["$filter","$locale",function(e,t){return function(e,t){return moment.isMoment(e)?e.format(t):""}}]),app.filter("objToArray",["$filter",function(e){return function(e){return e instanceof Object?_.values(e):e}}]),app.filter("porgSite",["$filter",function(e){return function(e,t){var a=[];return _.forEach(e,function(e){"all"!==t&&e.parentPOrg!==t||a.push(e)}),a}}]);
//# sourceMappingURL=app/scripts.min.js.map